import{u as U,A,K as m,W as i,B as R,c as b,w as s,$ as F,ab as h,aj as q,o as c,b as r,_ as z,ak as $,v as u,l as g,m as J,k as j,a1 as D,a2 as G,G as K,X as L,h as x,t as O,a0 as W}from"./app-DlGd_NOW.js";import{_ as X,n as v}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BfSscY-T.js";import{u as _,r as y}from"./index-BCwlJIxQ.js";import{u as H}from"./project-DiB0_pof.js";import{u as M}from"./jobExecution-Dcnq31yo.js";const le=U({__name:"Execute",setup(Q){const{t:n}=A(),k=m({title:n("jobs.executeJob")});document.title=k.value.title;const B=h(),w=q(),I=H(),d=M();d.getJobsAvailable(),I.getProjects();const f=m(!0),E=i(()=>d.loading),V=i(()=>d.jobsAvailable),P=i(()=>I.projects),N=i(()=>V.value.find(o=>o.value===e.value.jobId)??{}),e=m({jobId:null,projectId:null,name:null,params:null}),C=m({jobId:null,projectId:null,name:null,params:null}),t=_({projectId:{required:y},jobId:{required:y}},e),S=()=>{if(t.value.$invalid){v("error",n("common.fieldsValidationError"));return}d.executeJob(e.value.projectId,e.value.jobId,e.value.name,e.value.params).then(o=>{T(),v("success",n("jobs.jobExecutedSuccessfully")),w.push({name:"job-details",params:{jobExecutionId:o.jobExecution.id}})}).catch(o=>{v("error",n("jobs.errorExecutingJob")+": "+o.message)})};function T(){t.value.$reset(),setTimeout(()=>{e.value=Object.assign({},C.value)},300)}return R(()=>B.params.projectId,(o,l)=>{e.value.projectId=parseInt(o),isNaN(e.value.projectId)&&(e.value.projectId=null)},{immediate:!0}),(o,l)=>(c(),b(F,{justify:"center",align:"center",class:"fill-height"},{default:s(()=>[r(W,{cols:"6"},{default:s(()=>[r(X,{title:o.$t("jobs.executeJob")},{default:s(()=>[r(z,{ref:"form",modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=a=>f.value=a),"lazy-validation":""},{default:s(()=>[o.$route.params.projectId?j("",!0):(c(),b($,{key:0,modelValue:e.value.projectId,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.projectId=a),label:o.$t("jobs.selectProject"),items:P.value,variant:"solo","item-value":"id","item-title":"name",clearable:"",onBlur:u(t).projectId.$touch,onInput:u(t).projectId.$touch,"error-messages":u(t).projectId.$errors.map(a=>a.$message)},{item:s(({props:a,item:p})=>[r(g,J(a,{subtitle:p.raw.db_host}),null,16,["subtitle"])]),_:1},8,["modelValue","label","items","onBlur","onInput","error-messages"])),r($,{modelValue:e.value.jobId,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.jobId=a),label:o.$t("jobs.selectJob"),items:V.value,variant:"solo",clearable:"",onBlur:u(t).jobId.$touch,onInput:u(t).jobId.$touch,"error-messages":u(t).jobId.$errors.map(a=>a.$message)},{item:s(({props:a,item:p})=>[r(g,J(a,{subtitle:p.raw.description}),null,16,["subtitle"])]),_:1},8,["modelValue","label","items","onBlur","onInput","error-messages"]),e.value.jobId?(c(),b(D,{key:1,variant:"solo","hide-details":"",modelValue:e.value.name,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.name=a),label:o.$t("jobs.jobName"),class:"mb-5"},null,8,["modelValue","label"])):j("",!0),N.value.allow_params?(c(),b(G,{key:2,modelValue:e.value.params,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.params=a),label:o.$t("jobs.jobParams"),variant:"solo",clearable:""},null,8,["modelValue","label"])):j("",!0)]),_:1},8,["modelValue"]),r(K,{color:"primary",flat:"",class:"mt-5",onClick:l[5]||(l[5]=a=>S()),disabled:E.value},{default:s(()=>[r(L,{class:"mr-2"},{default:s(()=>l[6]||(l[6]=[x("mdi-database-sync")])),_:1}),x(" "+O(o.$t("jobs.executeJob")),1)]),_:1},8,["disabled"])]),_:1},8,["title"])]),_:1})]),_:1}))}});export{le as default};
